FROM php:8.4-apache
ENV DEBIAN_FRONTEND=noninteractive

RUN apt-get update \
  && apt-get install -y --no-install-recommends \
  ca-certificates \
  curl \
  tzdata \
  && docker-php-ext-install mysqli pdo pdo_mysql \
  && a2enmod rewrite expires \
  && apt-get clean \
  && rm -rf /var/lib/apt/lists/*

# ---- LogAnalyzer Build-Parameter ----
ARG LOGANALYZER_VERSION=4.1.13
ARG LOGANALYZER_URL="https://download.adiscon.com/loganalyzer/loganalyzer-${LOGANALYZER_VERSION}.tar.gz"

RUN set -eux; \
  test -n "${LOGANALYZER_VERSION}"; \
  test -n "${LOGANALYZER_URL}"; \
  UNPACK_DIR="/tmp/la/unpack"; \
  mkdir -p "${UNPACK_DIR}"; \
  curl -fSL "${LOGANALYZER_URL}" -o /tmp/la/archive; \
  tar -xzf /tmp/la/archive --strip-components=1 -C "${UNPACK_DIR}"; \
  CONTENT_DIR="${UNPACK_DIR}/src"; \
  rm -rf /var/www/html/*; \
  cp -a "${CONTENT_DIR}/." /var/www/html/; \
  chown -R www-data:www-data /var/www/html; \
  rm -rf /tmp/la
